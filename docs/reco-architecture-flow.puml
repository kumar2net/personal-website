@startuml
skinparam dpi 150
skinparam ArrowThickness 1.2
skinparam RectangleBorderColor #333
skinparam RectangleBackgroundColor #f8f8f8
skinparam packageBorderColor #999
skinparam packageBackgroundColor #ffffff

rectangle "React UI" as UI
rectangle "Express Proxy\n(/api/recommendations, /api/track)" as NX
rectangle "Python API\n(/recommendations, /log_interaction)" as PY
database "Feature/Vector Store" as FS

UI --> NX : GET /api/recommendations?post_id=...
NX --> PY : POST /recommendations {post_id, user_seg}
PY --> FS : Load embeddings + GA aggregates
PY --> NX : Top-N recommendations
NX --> UI : JSON -> render cards

package "Tracking" {
  UI -[#blue]-> NX : POST /api/track\n{user_id, post_id, event}
  NX -[#blue]-> PY : forward
  PY -[#blue]-> FS : append interaction
}

package "Retraining Cycle" {
  rectangle "GA nightly export" as GA
  rectangle "Feature Aggregation" as AGG
  rectangle "Recompute embeddings + features" as FEAT
  rectangle "Train/Update model + vector index" as TRAIN
  GA -[#gray,dashed]-> AGG
  FS -[#gray,dashed]-> AGG
  AGG -[#gray,dashed]-> FEAT
  FEAT -[#gray,dashed]-> TRAIN
  TRAIN -[#gray,dashed]-> PY : hot reload/index swap
}
@enduml



