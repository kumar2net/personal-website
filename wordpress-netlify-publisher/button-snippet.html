
<!-- WordPress to Netlify Publisher Button -->
<div id="netlify-publisher" style="margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; background: #f9f9f9;">
  <h3 style="margin: 0 0 10px 0; color: #333;">üåê Publish to Netlify</h3>
  <p style="margin: 0 0 15px 0; color: #666; font-size: 14px;">
    Click the button below to publish this post to your Netlify site.
  </p>
  
  <button id="publish-to-netlify-btn" 
          style="background: #00ad9f; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;"
          onclick="publishToNetlify()">
    üì§ Publish to Netlify
  </button>
  
  <div id="publish-status" style="margin-top: 10px; display: none;">
    <div id="publish-loading" style="display: none; color: #666;">
      <span style="display: inline-block; animation: spin 1s linear infinite;">‚è≥</span> Publishing to Netlify...
    </div>
    <div id="publish-success" style="display: none; color: #28a745;">
      ‚úÖ Successfully published to Netlify!
      <div id="netlify-url" style="margin-top: 5px; font-size: 12px;"></div>
    </div>
    <div id="publish-error" style="display: none; color: #dc3545;">
      ‚ùå Failed to publish to Netlify
      <div id="error-details" style="margin-top: 5px; font-size: 12px;"></div>
    </div>
  </div>
</div>

<style>
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#publish-to-netlify-btn:hover {
  background: #008f83 !important;
}

#publish-to-netlify-btn:disabled {
  background: #ccc !important;
  cursor: not-allowed !important;
}
</style>

<script>
async function publishToNetlify() {
  const button = document.getElementById('publish-to-netlify-btn');
  const status = document.getElementById('publish-status');
  const loading = document.getElementById('publish-loading');
  const success = document.getElementById('publish-success');
  const error = document.getElementById('publish-error');
  const netlifyUrl = document.getElementById('netlify-url');
  const errorDetails = document.getElementById('error-details');
  
  // Get post ID from WordPress
  const postId = getPostId();
  
  if (!postId) {
    showError('Could not determine post ID');
    return;
  }
  
  // Show loading state
  button.disabled = true;
  status.style.display = 'block';
  loading.style.display = 'block';
  success.style.display = 'none';
  error.style.display = 'none';
  
  try {
    const response = await fetch('https://kumarsite.netlify.app/.netlify/functions/wordpress-manual-publish', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        postId: postId,
        action: 'publish'
      })
    });
    
    const result = await response.json();
    
    if (response.ok && result.success) {
      showSuccess(result.netlify_url);
    } else {
      showError(result.error || result.details || 'Unknown error');
    }
  } catch (err) {
    showError('Network error: ' + err.message);
  }
}

function showSuccess(netlifyUrl) {
  const loading = document.getElementById('publish-loading');
  const success = document.getElementById('publish-success');
  const netlifyUrlDiv = document.getElementById('netlify-url');
  
  loading.style.display = 'none';
  success.style.display = 'block';
  netlifyUrlDiv.innerHTML = '<a href="' + netlifyUrl + '" target="_blank" style="color: #00ad9f;">View on Netlify ‚Üí</a>';
  
  // Re-enable button after 3 seconds
  setTimeout(() => {
    document.getElementById('publish-to-netlify-btn').disabled = false;
  }, 3000);
}

function showError(message) {
  const loading = document.getElementById('publish-loading');
  const error = document.getElementById('publish-error');
  const errorDetails = document.getElementById('error-details');
  
  loading.style.display = 'none';
  error.style.display = 'block';
  errorDetails.textContent = message;
  
  // Re-enable button
  document.getElementById('publish-to-netlify-btn').disabled = false;
}

function getPostId() {
  // Try different methods to get post ID
  const urlParams = new URLSearchParams(window.location.search);
  const postId = urlParams.get('post');
  
  if (postId) return postId;
  
  // Try to get from WordPress admin
  if (window.wp && window.wp.data && window.wp.data.select('core/editor')) {
    try {
      return window.wp.data.select('core/editor').getCurrentPostId();
    } catch (e) {
      // Ignore error
    }
  }
  
  // Try to get from page URL
  const urlMatch = window.location.pathname.match(/\/wp-admin\/post\.php\?post=(\d+)/);
  if (urlMatch) return urlMatch[1];
  
  // Try to get from post edit page
  const editMatch = window.location.pathname.match(/\/wp-admin\/post\.php\?action=edit&post=(\d+)/);
  if (editMatch) return editMatch[1];
  
  return null;
}

// Auto-detect if we're on a post page and show button
document.addEventListener('DOMContentLoaded', function() {
  const postId = getPostId();
  if (postId) {
    console.log('WordPress to Netlify Publisher: Post ID detected:', postId);
  }
});
</script>
